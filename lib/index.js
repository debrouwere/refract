// Generated by CoffeeScript 1.8.0
(function() {
  var evaluate, requote, string, _;

  evaluate = (require('coffee-script'))["eval"];

  _ = require('underscore');

  _.str = require('underscore.string');

  _.str.identity = _.identity;

  string = function(value) {
    return '"' + value + '"';
  };

  requote = function(value) {
    if (value.match(/^'.*'$/)) {
      return string(value.slice(1, -1));
    } else {
      return value;
    }
  };

  module.exports = function(template, context, options) {
    var err, normalize, refract, value;
    if (options == null) {
      options = {};
    }
    _.defaults(options, {
      normalize: 'identity'
    });
    refract = _.partial(module.exports, _, context);
    normalize = _.str[options.normalize];
    switch (template.constructor) {
      case Object:
        return _.object(_.map(template, function(value, key) {
          return [normalize(key), refract(value)];
        }));
      case Array:
        return _.map(template, refract);
      default:
        value = requote(template);
        try {
          return evaluate(value, {
            sandbox: context
          });
        } catch (_error) {
          err = _error;
          return evaluate(string(value), {
            sandbox: context
          });
        }
    }
  };

  module.exports.builtinHelpers = _.extend({}, _, _.str);

}).call(this);
